!function(){function e(e,t){return console.assert(l.has(t),"Tipo de entidad "+t+" incorrecta. No se encuentra en el arquetipo"),console.assert(l.get(t).has(e),"Atributo "+e+" en el tipo de Entidad "+t+" no encontrado"),l.get(t).get(e)}function t(e,t){return console.assert(l.has(t),"Tipo de entidad "+t+" incorrecta. No se encuentra en el arquetipo"),l.get(t).has(e)?!0:!1}function i(e,t){c=(9301*c+49297)%233280;var i=void 0==t?0:e-1,a=void 0==t?e:t;return Math.min(a,i+Math.ceil(c/233280*a))}function a(){g.training=1,g.createChallenge=0,g.fontStyle={font:"20px Arial",fill:"#FFFFFF",align:"center"},g.fontStyleMenu={font:"bold 60pt TheMinion",fill:"#FDFFB5",align:"center"},g.score=0,g.shipDestroyed=!1,g.shipIsVulnerable=!1,g.startingAsteroid=e("startingAteroids","Map"),g.asteroidGroup=null,g.player=null,g.timeToUpdateAsteroids=5}var n={preload:function(){console.assert(u.Logic.init(),"Servidor de lÃ³gica mal iniciado.")},create:function(){this.aux=0,this.begin=!1,this.timeToBegin=3,a(),u.Logic.getinstance().preload(),sound_ambiental.play(),this.game.time.events.add(Phaser.Timer.SECOND,this.updateTimeToBegin,this),this.timeText=this.game.add.text(.5*this.game.width,30,this.timeToBegin,{font:"30px Arial",fill:"#FFFFFF",align:"center"})},update:function(){this.begin?u.Logic.getinstance().update():1==this.aux?(this.timeText.fontSize+=1,this.aux=0):this.aux=1},updateTimeToBegin:function(){this.begin=!0,--this.timeToBegin,this.timeText.text=this.timeToBegin,this.timeText.fontSize=30,this.timeToBegin>0?(this.begin=!1,this.game.time.events.add(Phaser.Timer.SECOND,this.updateTimeToBegin,this)):(this.timeText.text="",u.Logic.getinstance().create())}},s={preload:function(){},create:function(){sound_ambiental.mute=1;var e=game.add.sprite(-70,-5,"space");e.scale.setTo(1.9,1.9),g.training&&(this.gameOverText=game.add.text(.5*game.world.width,.5*game.world.height,"SCORE: "+g.score+" \nGAME OVER\nPress SPACE to restart",{font:"22px Lucida Console",fill:"#fff",align:"center"}),this.gameOverText.fixedToCamera=!0),addTime(g.score)},startGame:function(){u.Logic.getinstance().destroy(),sound_ambiental.mute=0,game.state.start("play")},update:function(){game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&g.training&&this.startGame()}},o={counter:0,step:2*Math.PI/360,preload:function(){this.snd_select=game.add.audio("snd_selectMenu",.5)},addButton:function(e,t,i,a,n,s,o){var r=game.add.text(e,t,i,{font:a,fill:n,align:s});r.inputEnabled=!0,void 0!=o&&r.events.onInputUp.add(o),r.input.useHandCursor=!0},create:function(){var e=game.add.sprite(-70,-5,"menu-bg");e.scale.setTo(1,1.25),game.add.text(.2*game.width,20,"ASTEROIDS",{font:"bold 60pt dimwitgauche",fill:"#FDFFB5",align:"center"}),this.addButton(50,300,"START","bold 30pt TheMinion","#FFFFFF","center",this.startGame),this.addButton(50,375,"OPTIONS","bold 30pt TheMinion","#FFFFFF","center"),this.addButton(50,450,"CREDITS","bold 30pt TheMinion","#FFFFFF","center")},startGame:function(){game.state.start("play")},update:function(){}},r={preload:function(){this.preloadBar=this.game.add.sprite(100,300,"loadBar"),this.load.setPreloadSprite(this.preloadBar),game.load.image(e("nombreSprite","Bullet"),e("sprite","Bullet")),game.load.image(e("nombreSprite","Player"),e("sprite","Player")),game.load.image(e("nombreSprite","AsteroidSmall"),e("sprite","AsteroidSmall")),game.load.image(e("nombreSprite","AsteroidMedium"),e("sprite","AsteroidMedium")),game.load.image(e("nombreSprite","AsteroidLarge"),e("sprite","AsteroidLarge")),game.load.image(e("nombreSprite","AsteroidVerySmall"),e("sprite","AsteroidVerySmall")),game.load.audio("snd_star",["game/assets/audio/shoot.wav"]),game.load.audio("snd_ambiental",["game/assets/audio/space2.ogg"]),game.load.audio("snd_dead",["game/assets/audio/dead.wav"]),game.load.audio("snd_selectMenu",["game/assets/audio/menu.wav"]),game.load.image("startButton","game/assets/images/startButton.png"),game.load.image("menu-bg","game/assets/images/menu.jpg"),game.load.image("cursor","game/assets/images/cursor.png"),game.load.image("smokeAsteroids","game/assets/images/Smoke10.png"),game.load.image("heart","game/assets/images/heart.png"),game.load.spritesheet(e("nombreSprite","Explosion"),e("sprite","Explosion"),25,25,18)},create:function(){this.preloadBar.cropEnabled=!1,sound_ambiental=game.add.audio("snd_ambiental",.5),game.state.start("menu")}},d={preload:function(){game.load.image("loadBar","game/assets/images/loadBar.png")},create:function(){game.renderer.clearBeforeRender=!1,game.renderer.roundPixels=!0,game.physics.startSystem(Phaser.Physics.ARCADE),game.input.keyboard.addKeyCapture(Phaser.Keyboard.SPACEBAR),game.input.keyboard.addKeyCapture(Phaser.Keyboard.LEFT),game.input.keyboard.addKeyCapture(Phaser.Keyboard.RIGHT),game.input.keyboard.addKeyCapture(Phaser.Keyboard.UP),game.input.keyboard.addKeyCapture(Phaser.Keyboard.DOWN),game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,game.state.start("load")}};Componente=function(){},Componente.prototype={create:function(){},update:function(){},deadEntity:function(){},respawn:function(){}};var y=y||[];y.CSmokeAsteroid=function(e,t){this._entityType=e,this._entity=t},y.CSmokeAsteroid.prototype=Object.create(Componente.prototype,{create:{value:function(){this.emitter=game.add.emitter(game.world.centerX,game.world.centerY,400),this.emitter.makeParticles("smokeAsteroids"),this.emitter.gravity=200,this.emitter.livespan=1e3,this.emitter.setAlpha(1,0,1e3),this.emitter.setScale(.2,0,.1,0,1e3),this.emitter.start(!1,1e3,50)}},update:{value:function(){var e=this._entity.entityGraphic.body.velocity.x,t=this._entity.entityGraphic.body.velocity.y;e*=-1,t*=-1,this.emitter.minParticleSpeed.set(e,t),this.emitter.maxParticleSpeed.set(e,t),this.emitter.emitX=this._entity.entityGraphic.x,this.emitter.emitY=this._entity.entityGraphic.y}},deadEntity:{value:function(){this.emitter.destroy()}}});var y=y||[];y.CPlayerController=function(e,t){this._entityType=e,this._entity=t},y.CPlayerController.prototype=Object.create(Componente.prototype,{update:{value:function(){game.input.keyboard.isDown(Phaser.Keyboard.UP)||game.input.keyboard.isDown(Phaser.Keyboard.W)?game.physics.arcade.accelerationFromRotation(1.5708,-500,this._entity.entityGraphic.body.acceleration):game.input.keyboard.isDown(Phaser.Keyboard.DOWN)||game.input.keyboard.isDown(Phaser.Keyboard.S)?game.physics.arcade.accelerationFromRotation(4.7124,-500,this._entity.entityGraphic.body.acceleration):this._entity.entityGraphic.body.acceleration.set(0),game.input.keyboard.isDown(Phaser.Keyboard.LEFT)||game.input.keyboard.isDown(Phaser.Keyboard.A)?this._entity.entityGraphic.body.acceleration.x=-500:game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)||game.input.keyboard.isDown(Phaser.Keyboard.D)?this._entity.entityGraphic.body.acceleration.x=500:this._entity.entityGraphic.body.angularVelocity=0,this.screenWrap(this._entity.entityGraphic),this._entity.entityGraphic.rotation=game.physics.arcade.angleToPointer(this._entity.entityGraphic)}}}),y.CPlayerController.prototype.screenWrap=function(t){t.x+e("padding",this._entityType)<0?t.x=game.width+e("padding",this._entityType):t.x-e("padding",this._entityType)>game.width&&(t.x=-e("padding",this._entityType)),t.y+e("padding",this._entityType)<0?t.y=game.height+e("padding",this._entityType):t.y-e("padding",this._entityType)>game.height&&(t.y=-e("padding",this._entityType))};var y=y||[];y.CAsteroidController=function(e,t){this._entityType=e,this._entity=t},y.CAsteroidController.prototype=Object.create(Componente.prototype,{create:{value:function(){void 0==g.asteroidGroup&&(g.asteroidGroup=game.add.group(),g.asteroidGroup.enableBody=e("enableBody",this._entityType),g.asteroidGroup.physicsBodyType=Phaser.Physics.ARCADE),this._entity.entityGraphic=g.asteroidGroup.create(this._entity.getPosition.x,this._entity.getPosition.y,e("nombreSprite",this._entityType)),this._entity.entityGraphic.scale.setTo(e("scaleX",this._entityType),e("scaleY",this._entityType)),this._entity.entityGraphic.anchor.set(.5,.5),this._angularVelocity=i(e("minAngularVelocity",this._entityType),e("maxAngularVelocity",this._entityType));var t=game.math.degToRad(i(-180,180)),a=i(e("minVelocity",this._entityType),e("maxVelocity",this._entityType));game.physics.arcade.velocityFromRotation(t,a,this._entity.entityGraphic.body.velocity)}},update:{value:function(){this._entity.entityGraphic.body.angularVelocity=this._angularVelocity,this.screenWrap(this._entity.entityGraphic)}}}),y.CAsteroidController.prototype.screenWrap=function(t){t.x+e("padding",this._entityType)<0?t.x=game.width+e("padding",this._entityType):t.x-e("padding",this._entityType)>game.width&&(t.x=-e("padding",this._entityType)),t.y+e("padding",this._entityType)<0?t.y=game.height+e("padding",this._entityType):t.y-e("padding",this._entityType)>game.height&&(t.y=-e("padding",this._entityType))};var y=y||[];y.CExplosionController=function(e,t){this._entityType=e,this._entity=t},y.CExplosionController.prototype=Object.create(Componente.prototype,{create:{value:function(){this._entity.entityGraphic=game.add.sprite(this._entity.getPosition.x-5,this._entity.getPosition.y-10,e("nombreSprite",this._entityType)),this._entity.entityGraphic.animations.add("explode",null,70,!1),this._entity.entityGraphic.animations.play("explode"),game.time.events.add(.5*Phaser.Timer.SECOND,this.deadEntity,this)}},deadEntity:{value:function(){console.log("destroy"),this._entity.entityGraphic.destroy()}}});var y=y||[];y.CGraphics=function(e,t){this._entityType=e,this._entity=t},y.CGraphics.prototype=Object.create(Componente.prototype,{create:{value:function(){Componente.prototype.create.apply(),this._entity.entityGraphic=game.add.sprite(this._entity.getPosition.x,this._entity.getPosition.y,e("nombreSprite",this._entityType)),this._entity.entityGraphic.anchor.set(.5)}}});var y=y||[];y.CPhysics=function(e,t){this._entityType=e,this._entity=t},y.CPhysics.prototype=Object.create(Componente.prototype,{create:{value:function(){game.physics.arcade.enable(this._entity.entityGraphic),t("bounce",this._entityType)&&(this._entity.entityGraphic.body.bounce.y=e("bounce",this._entityType)),t("gravity",this._entityType)&&(this._entity.entityGraphic.body.gravity.y=e("gravity",this._entityType)),t("drag",this._entityType)&&this._entity.entityGraphic.body.drag.set(e("drag",this._entityType)),t("maxVelocity",this._entityType)&&this._entity.entityGraphic.body.maxVelocity.set(e("maxVelocity",this._entityType)),t("collideWorldBounds",this._entityType)&&(this._entity.entityGraphic.body.collideWorldBounds=e("collideWorldBounds",this._entityType))}}});var y=y||[];y.CBulletController=function(e,t){this._entityType=e,this._entity=t},y.CBulletController.prototype=Object.create(Componente.prototype,{create:{value:function(){this._entity.entityGraphic.createMultiple(e("cantidadCrear",this._entityType),e("nombreSprite",this._entityType)),this._entity.entityGraphic.setAll("anchor.x",e("scaleX",this._entityType)),this._entity.entityGraphic.setAll("anchor.y",e("scaleY",this._entityType)),this._bulletTime=0,game.input.mouse.capture=!0,this.snd_bullet=game.add.audio("snd_star",.5)}},update:{value:function(){game.input.activePointer.leftButton.isDown&&!g.shipDestroyed&&this.fireBullet(),game.debug.body(this._entity.entityGraphic)}}}),y.CBulletController.prototype.fireBullet=function(){if(game.time.now>this._bulletTime){var t=this._entity.entityGraphic.getFirstExists(!1);if(t){this.snd_bullet.play();var i=g.player.entityGraphic;t.reset(i.body.x+16,i.body.y+16),t.lifespan=e("life","Bullet"),t.rotation=i.rotation,game.physics.arcade.velocityFromRotation(i.rotation,400,t.body.velocity),this._bulletTime=game.time.now+125}}},y.CBulletController.prototype.screenWrap=function(t){t.x+e("padding",this._entityType)<0?t.x=game.width+e("padding",this._entityType):t.x-e("padding",this._entityType)>game.width&&(t.x=-e("padding",this._entityType)),t.y+e("padding",this._entityType)<0?t.y=game.height+e("padding",this._entityType):t.y-e("padding",this._entityType)>game.height&&(t.y=-e("padding",this._entityType))};var y=y||[];y.CAsteroidPhysic=function(e,t){this._entityType=e,this._entity=t},y.CAsteroidPhysic.prototype=Object.create(Componente.prototype,{create:{value:function(){this.snd_dead=game.add.audio("snd_dead"),this.snd_killAsteroid=game.add.sound("snd_dead")}},update:{value:function(){g.shipIsVulnerable||game.physics.arcade.overlap(g.player.entityGraphic,this._entity.entityGraphic,this.collision,null,this),game.physics.arcade.overlap(h.EntityFactory.getinstance().Groups.get("Bullet"),this._entity.entityGraphic,this.collision,null,this)}}}),y.CAsteroidPhysic.prototype.collision=function(i,a){var n=a.position;if(i.kill(),h.EntityFactory.getinstance().deleteEntity(this._entity,a),h.EntityFactory.getinstance().createEntity("Explosion",new Phaser.Point(n.x-5,n.y-10)),t("sizeLess",this._entityType)){var s=e("sizeLess",this._entityType);h.EntityFactory.getinstance().createEntity(s,new Phaser.Point(n.x+10,n.y+10)),h.EntityFactory.getinstance().createEntity(s,new Phaser.Point(n.x+10,n.y+10))}i!=g.player.entityGraphic?(this.snd_killAsteroid.play("",0,e("volumenExplosion",this._entityType)),m.GameManager.getinstance().addScore=e("score",this._entityType)):(m.GameManager.getinstance().destroyShip(),this.snd_dead.play()),g.asteroidGroup.remove(this._entity.entityGraphic)};var l=new Map;l.set("Player",new Map),l.get("Player").set("speedX",300),l.get("Player").set("speedY",-400),l.get("Player").set("scaleX",1),l.get("Player").set("scaleY",1),l.get("Player").set("bounce",0),l.get("Player").set("gravity",0),l.get("Player").set("speedAnimation",20),l.get("Player").set("acceleration",300),l.get("Player").set("drag",150),l.get("Player").set("maxVelocity",200),l.get("Player").set("angularVelocity",100),l.get("Player").set("nombreSprite","playerSprite"),l.get("Player").set("sprite","game/assets/images/ship4.png"),l.get("Player").set("spritesheetX",32),l.get("Player").set("spritesheetY",48),l.get("Player").set("spritesheetY",48),l.get("Player").set("animaciones",new Map),l.get("Player").get("animaciones").set("left",[0,1,2,3]),l.get("Player").get("animaciones").set("right",[5,6,7,8]),l.get("Player").get("animaciones").set("idle",[4]),l.get("Player").set("collideWorldBounds",0),l.get("Player").set("shipLives",3),l.get("Player").set("timeToReset",3),l.get("Player").set("padding",16),l.set("Bullet",new Map),l.get("Bullet").set("speed",400),l.get("Bullet").set("scaleX",.5),l.get("Bullet").set("scaleY",.5),l.get("Bullet").set("cantidadCrear",10),l.get("Bullet").set("life",575),l.get("Bullet").set("group",1),l.get("Bullet").set("nombreSprite","bulletSprite"),l.get("Bullet").set("sprite","game/assets/images/bullets.png"),l.get("Bullet").set("enableBody",1),l.set("AsteroidVerySmall",new Map),l.get("AsteroidVerySmall").set("minVelocity",100),l.get("AsteroidVerySmall").set("maxVelocity",125),l.get("AsteroidVerySmall").set("minAngularVelocity",450),l.get("AsteroidVerySmall").set("maxAngularVelocity",650),l.get("AsteroidVerySmall").set("score",150),l.get("AsteroidVerySmall").set("scaleX",.4),l.get("AsteroidVerySmall").set("scaleY",.4),l.get("AsteroidVerySmall").set("volumenExplosion",.2),l.get("AsteroidVerySmall").set("nombreSprite","AsteroidVerySmallSprite"),l.get("AsteroidVerySmall").set("sprite","game/assets/images/asteroid24.png"),l.get("AsteroidVerySmall").set("enableBody",1),l.get("AsteroidVerySmall").set("padding",16),l.set("AsteroidSmall",new Map),l.get("AsteroidSmall").set("minVelocity",70),l.get("AsteroidSmall").set("maxVelocity",175),l.get("AsteroidSmall").set("minAngularVelocity",250),l.get("AsteroidSmall").set("maxAngularVelocity",500),l.get("AsteroidSmall").set("score",100),l.get("AsteroidSmall").set("scaleX",.65),l.get("AsteroidSmall").set("scaleY",.65),l.get("AsteroidSmall").set("volumenExplosion",.4),l.get("AsteroidSmall").set("nombreSprite","AsteroidSmallSprite"),l.get("AsteroidSmall").set("sprite","game/assets/images/asteroid1.png"),l.get("AsteroidSmall").set("enableBody",1),l.get("AsteroidSmall").set("sizeLess","AsteroidVerySmall"),l.get("AsteroidSmall").set("padding",16),l.set("AsteroidMedium",new Map),l.get("AsteroidMedium").set("minVelocity",60),l.get("AsteroidMedium").set("maxVelocity",125),l.get("AsteroidMedium").set("minAngularVelocity",200),l.get("AsteroidMedium").set("maxAngularVelocity",350),l.get("AsteroidMedium").set("score",50),l.get("AsteroidMedium").set("scaleX",.85),l.get("AsteroidMedium").set("scaleY",.85),l.get("AsteroidMedium").set("volumenExplosion",.7),l.get("AsteroidMedium").set("nombreSprite","AsteroidMediumSprite"),l.get("AsteroidMedium").set("sprite","game/assets/images/asteroid24.png"),l.get("AsteroidMedium").set("enableBody",1),l.get("AsteroidMedium").set("sizeLess","AsteroidSmall"),l.get("AsteroidMedium").set("padding",16),l.set("AsteroidLarge",new Map),l.get("AsteroidLarge").set("minVelocity",50),l.get("AsteroidLarge").set("maxVelocity",100),l.get("AsteroidLarge").set("minAngularVelocity",100),l.get("AsteroidLarge").set("maxAngularVelocity",250),l.get("AsteroidLarge").set("score",20),l.get("AsteroidLarge").set("scaleX",1.25),l.get("AsteroidLarge").set("scaleY",1.25),l.get("AsteroidLarge").set("volumenExplosion",1),l.get("AsteroidLarge").set("nombreSprite","AsteroidLargeSprite"),l.get("AsteroidLarge").set("sprite","game/assets/images/asteroid1.png"),l.get("AsteroidLarge").set("enableBody",1),l.get("AsteroidLarge").set("sizeLess","AsteroidMedium"),l.get("AsteroidLarge").set("padding",16),l.set("Map",new Map),l.get("Map").set("startingAteroids",3),l.get("Map").set("maxAsteroids",20),l.get("Map").set("incrementAteroids",2),l.get("Map").set("delayToStartLevel",3),l.set("Explosion",new Map),l.get("Explosion").set("sprite","game/assets/images/explode.png"),l.get("Explosion").set("nombreSprite","explosionSprite");var p=new Map;p.set("Player",[{name:"CGraphics",object:y.CGraphics},{name:"CPhysics",object:y.CPhysics},{name:"CPlayerController",object:y.CPlayerController}]),p.set("Bullet",[{name:"CBulletController",object:y.CBulletController}]),p.set("AsteroidVerySmall",[{name:"CAsteroidController",object:y.CAsteroidController},{name:"CAsteroidPhysic",object:y.CAsteroidPhysic},{name:"CSmokeAsteroid",object:y.CSmokeAsteroid}]),p.set("AsteroidSmall",[{name:"CAsteroidController",object:y.CAsteroidController},{name:"CAsteroidPhysic",object:y.CAsteroidPhysic},{name:"CSmokeAsteroid",object:y.CSmokeAsteroid}]),p.set("AsteroidMedium",[{name:"CAsteroidController",object:y.CAsteroidController},{name:"CAsteroidPhysic",object:y.CAsteroidPhysic},{name:"CSmokeAsteroid",object:y.CSmokeAsteroid}]),p.set("AsteroidLarge",[{name:"CAsteroidController",object:y.CAsteroidController},{name:"CAsteroidPhysic",object:y.CAsteroidPhysic},{name:"CSmokeAsteroid",object:y.CSmokeAsteroid}]),p.set("Explosion",[{name:"CExplosionController",object:y.CExplosionController}]);var c=Date.now(),g={};"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t});var h=h||[];h.Entity=function(e,t,i){this.Components=new Map,this._position=t,this._entityType=e,this._entityGraphic=i?h.EntityFactory.getinstance().Groups.get(this._entityType):null},h.Entity.prototype={create:function(){this.Components.forEach(function(e){e.create()})},update:function(){this.Components.forEach(function(e){e.update()})},addComponent:function(e,t){console.log("nameComponent",e," objectComponent",t),this.Components.set(e,new t(this._entityType,this))},deadEntity:function(){this._entityGraphic.kill(),this.Components.forEach(function(e){e.deadEntity()})}},Object.defineProperty(h.Entity.prototype,"entityType",{get:function(){return this._entityType}}),Object.defineProperty(h.Entity.prototype,"getPosition",{get:function(){return this._position}}),Object.defineProperty(h.Entity.prototype,"entityGraphic",{get:function(){return this._entityGraphic},set:function(e){this._entityGraphic=e}});var h=h||[];h.MapGenerator=function(){console.assert(h.MapGenerator._semaphore,"Constructor MapGenerator privado")},h.MapGenerator.init=function(){return h.MapGenerator._instance||(h.MapGenerator._semaphore=1,h.MapGenerator._instance=new h.MapGenerator,h.MapGenerator._semaphore=0),game.load.image("space","game/assets/images/space2.png"),!0},h.MapGenerator.prototype={destroy:function(){h.MapGenerator._instance=null},preload:function(){var e=game.add.sprite(-70,-5,"space");e.scale.setTo(1.9,1.9),e.inputEnabled=!0,e.events.onInputOver.add(function(){game.canvas.style.cursor="url(game/assets/images/cursor.png),auto"},this)},create:function(){},update:function(){}},h.MapGenerator.getinstance=function(){return h.MapGenerator._instance};var m=m||[];m.GameManager=function(){console.assert(m.GameManager._semaphore,"Constructor GameManager privado")},m.GameManager.init=function(){return m.GameManager._instance||(m.GameManager._semaphore=1,m.GameManager._instance=new m.GameManager,m.GameManager._semaphore=0),!0},m.GameManager.prototype={destroy:function(){m.GameManager._instance=null},preload:function(){h.EntityFactory.getinstance().createEntity("Player",new Phaser.Point(.5*game.width,.5*game.height))},create:function(){g.shipDestroyed=!1,g.shipIsVulnerable=!1,this._shipLives=e("shipLives","Player"),this._timeToReset=e("timeToReset","Player"),game.add.sprite(20,10,"heart"),this.tf_lives=game.add.text(53,10,this._shipLives,g.fontStyle),g.score=0,this.tf_score=game.add.text(.5*game.width,10,g.score,{font:"25px Arial",fill:"#FFFFFF",align:"center"}),h.EntityFactory.getinstance().createEntity("Bullet",new Phaser.Point(32,450)),this.resetAsteroids()},update:function(){h.EntityFactory.getinstance().update(),"inherit"==game.canvas.style.cursor&&(game.canvas.style.cursor="url(game/assets/images/cursor.png),auto",console.log("Cambio de cursor"))},resetShip:function(){g.player.entityGraphic.reset(.5*game.width,.5*game.height),g.player.entityGraphic.angle=-90,g.shipDestroyed=!1,g.shipIsVulnerable=!0,game.time.events.add(Phaser.Timer.SECOND*this._timeToReset,this.shipReady,this),game.time.events.repeat(.2*Phaser.Timer.SECOND,.9*this._timeToReset/.2,this.shipBlink,this)},shipReady:function(){g.shipIsVulnerable=!1,g.player.entityGraphic.visible=!0},shipBlink:function(){g.player.entityGraphic.visible=!g.player.entityGraphic.visible},destroyShip:function(){--this._shipLives,this.tf_lives.text=this._shipLives,this._shipLives?game.time.events.add(Phaser.Timer.SECOND*this._timeToReset*.25,this.resetShip,this):(g.shipDestroyed=!0,game.state.start("over")),g.shipDestroyed=!0},resetAsteroids:function(){for(var e=0;e<g.startingAsteroid;++e)this.createAsteroids();game.time.events.add(Phaser.Timer.SECOND*g.timeToUpdateAsteroids,this.incrementalCurrentMaxAsteroids,this)},createAsteroids:function(){var e,t,a=Math.round(.01*i(0,100));a?(e=Math.round(.01*i(0,100))*game.width,t=.01*i(0,100)*game.height):(e=.01*i(0,100)*game.width,t=Math.round(.01*i(0,100))*game.height);var n=i(0,100),s="";s=35>=n?"AsteroidLarge":70>=n&&n>35?"AsteroidMedium":90>n&&n>70?"AsteroidSmall":"AsteroidVerySmall",h.EntityFactory.getinstance().createEntity(s,new Phaser.Point(e,t))},incrementalCurrentMaxAsteroids:function(){this.createAsteroids(),g.timeToUpdateAsteroids>2.5?g.timeToUpdateAsteroids=g.timeToUpdateAsteroids-.2:g.timeToUpdateAsteroids<=2.5&&g.timeToUpdateAsteroids>1.5&&(g.timeToUpdateAsteroids=g.timeToUpdateAsteroids-.05),console.log("Nuevo asteroide: "+g.timeToUpdateAsteroids),game.time.events.add(Phaser.Timer.SECOND*g.timeToUpdateAsteroids,this.incrementalCurrentMaxAsteroids,this)}},Object.defineProperty(m.GameManager.prototype,"addScore",{set:function(e){g.score+=e,this.tf_score.text=g.score}}),m.GameManager.getinstance=function(){return m.GameManager._instance};var h=h||[];h.EntityFactory=function(){console.assert(h.EntityFactory._semaphore,"Constructor EntityFactory privado"),this.Entity=[],this._Groups=new Map,this._EntityGroupToEntity=new Map},h.EntityFactory.init=function(){return h.EntityFactory._instance||(h.EntityFactory._semaphore=1,h.EntityFactory._instance=new h.EntityFactory,h.EntityFactory._semaphore=0),!0},h.EntityFactory.prototype={destroy:function(){h.EntityFactory._instance=null,this._Groups.get("Bullet").destroy(!0),this._Groups["delete"]("Bullet"),this._Groups=null,g.asteroidGroup.destroy(!0),g.asteroidGroup=null,this.Entity=[],this._EntityGroupToEntity=null},preload:function(){},create:function(){var t=game.add.group();t.enableBody=e("enableBody","Bullet"),t.physicsBodyType=Phaser.Physics.ARCADE,this._Groups.set("Bullet",t),g.asteroidGroup=game.add.group(),g.asteroidGroup.enableBody=1,g.asteroidGroup.physicsBodyType=Phaser.Physics.ARCADE},update:function(){this.Entity.forEach(function(e){e.update()})},createEntity:function(e,i){console.assert(p.has(e),"El tipo de entidad a crear no existe");var a=new h.Entity(e,i,t("group",e));return p.forEach(function(t,i){i==e&&t.forEach(function(e){a.addComponent(e.name,e.object)})}),a.create(),this.Entity.push(a),"Player"==e&&(g.player=a),a},deleteEntity:function(e,t){t.kill(),e.deadEntity();var i=this.Entity.indexOf(e);this.Entity.splice(i,1)}},h.EntityFactory.getinstance=function(){return h.EntityFactory._instance},Object.defineProperty(h.EntityFactory.prototype,"Groups",{get:function(){return this._Groups}}),Object.defineProperty(h.EntityFactory.prototype,"EntityGroupToEntity",{get:function(){return this._EntityGroupToEntity}});var u=u||{};u.Logic=function(){console.assert(u.Logic._semaphore,"Constructor ServerLogic privado")},u.Logic.init=function(){return u.Logic._instance||(u.Logic._semaphore=1,u.Logic._instance=new u.Logic,u.Logic._semaphore=0),h.EntityFactory.init()&&h.MapGenerator.init()&&m.GameManager.init()||window.pause(),!0},u.Logic.prototype={destroy:function(){u.Logic._instance=null,h.MapGenerator.getinstance().destroy(),h.EntityFactory.getinstance().destroy(),m.GameManager.getinstance().destroy()},preload:function(){h.MapGenerator.getinstance().preload(),h.EntityFactory.getinstance().preload(),m.GameManager.getinstance().preload()},create:function(){h.MapGenerator.getinstance().create(),h.EntityFactory.getinstance().create(),m.GameManager.getinstance().create()},update:function(){m.GameManager.getinstance().update()}},u.Logic.getinstance=function(){return u.Logic._instance},window.onload=function(){game=new Phaser.Game(750,600,Phaser.AUTO,"game-frame"),game.state.add("boot",d),game.state.add("load",r),game.state.add("menu",o),game.state.add("play",n),game.state.add("over",s),game.state.start("boot")}}();